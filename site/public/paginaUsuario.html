<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil</title>
    <link rel="stylesheet" href="css/paginaUsuario.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<!-- onload="validarSessao(), atualizacaoPeriodica()" -->
<!-- onload="carregarUserLogado() , receberUserLogado(usuarioLogado)" -->

<body>
    <!-- Inicio do Cabeçalho -->
    <div class="header">
        <div class="container">
            <span class="inicio">
                <img src="Img/tubarãozinho.png" alt="logo com um tubarãozinho lendo">
                <span class="titulo">Dynamic Readers</span></span>
            <ul>
                <li><a href="resumo.html">Resumo</a></li>
                <li>||</li>
                <li onclick="sair()">Sair</a></li>
            </ul>
        </div>
    </div>
    <!-- Final do Cabeçalho -->

    <!-- Primeiro Pedaço da Página -->
    <div class="conteudo01">

        <!-- Primeira coluna -->
        <div class="primeira_coluna">
            <div class="infoUsuario">

                <div class="info">
                    <div class="img01">
                        <img src="img/foto_usuario.png" alt="">
                    </div>
                    <div class="dados">
                        <span class="nomeUsuario" id="nomeDoUsuario">Nome Do usuário</span>
                        <span>Mensagem <img class="img02" src="img/editar.png" alt=""></span>
                    </div>

                </div>

            </div>

            <details>
                <summary>?</summary>
                Você pode visualizar aqui sua evolução mensal de acordo com os registros que fizer.
                obs: FS = Finais de Semana
            </details>

            <div class="graficoLinha">

                <div class="tituloProgresso">Progresso
                </div>
                <!-- Organizar o datalist com gráfico -->
                <div class="datalist_Grafico">

                    <div class="camposDatalist">
                        <label for="messes">Mês:</label>
                        <input list="mes" id="messes" name="messes" class="ipt_mesGL">

                        <datalist id="mes">
                            <option value="Janeiro">
                            <option value="Fevereiro">
                            <option value="Março">
                            <option value="Abril">
                            <option value="Maio">
                        </datalist>

                        <label for="anos">Ano:</label>
                        <input list="ano" id="anos" name="anos" class="ipt_anoGL">
                        <datalist id="ano">
                            <option value="2023">
                        </datalist>
                        <button onclick="consultar()">conssultar</button>
                    </div>

                    <div class="grafico01">
                        <div id="tituloGrafico01">Gráfico do mês de </div>

                        <div class="chart-container01">
                            <canvas id="myChart"></canvas>
                        </div>
                        <!-- <div id="graficos">
                <div id="grafico1" class="display-block">
                    <h3 class="tituloGraficos">
                        <span id="tituloAquario1">123</span>
                    </h3>
                    <div class="graph">
                        <canvas id="myChartCanvas1"></canvas>
                    </div>
                    <div class="label-captura">
                        <p id="avisoCaptura1" style="color: white"></p>
                    </div>
                </div> -->
                    </div>

                </div>

            </div>
        </div>


        <!-- Segunda coluna -->
        <div class="segunda_coluna">
            <div class="aviso">
                <div class="card">
                    <b>Você pode melhorar!</b>
                    <span class="text">Você está menos habituado a ler nas segunda, se esforce para passar de 8 páginas
                        todas
                        as segundas do mês. Você consegue!</span>
                </div>


            </div>

            <div class="tituloGrafico02">Gráfico de páginas por dia da semana
            </div>
            <details>
                <summary>?</summary>
                Aqui verá a media de páginas que lê em cada dia da semana.
                <br>
            </details>
            <div class="graficoPizza">
                <div class="grafico02">
                    <div class="chart-container" id="semana">
                        <canvas id="graficoSemana"></canvas>
                    </div>
                </div>

            </div>
        </div>


        <!-- Teceira coluna -->
        <div class="terceira_coluna">

            <div class="conquistas">
                <div class="tituloM">Conquistas</div>
                <div class="medalhas"><img src="img/star-medal.webp" alt=""><img src="img/star-medal.webp" alt=""><img
                        src="img/star-medal.webp" alt="">
                </div>
            </div>

            <div class="dica">
                <div class="tituloD">Dica</div>
                <div class="textoD">Tente usar um lápis ou uma régua para guiar seus olhos durante a leitura, vá
                    aumentando a velocidade que passa pelas linhas.
                </div>
            </div>

            <div class="tempoR">
                <div>
                    <div class="relogio"><img src="img/relogio.png" alt="">
                    </div>
                    <div class="tituloT">Tempo recorde</div>
                    <ul>
                        <li>Livro: Nome do livro</li>
                        <li>Data Inicio: 01/01/2023</li>
                        <li>Data final: 06/01/2023</li>
                        <li>total de páginas: 500</li>
                    </ul>
                </div>
            </div>

        </div>
        <!-- Fim do Primeiro Pedaço -->
    </div>

    <!-- Inicio da Segunda parte da Pagina -->
    <span class="titulo02">Registros</span>

    <!-- Primeira coluna02 -->
    <div class="conteudo02">
        <div class="primeira_coluna02">
            <div class="progressoDiario">
                <div class="tituloPD">Insira abaixo o seu progresso diário</div>

                <div class="formRegistrar">

                    <div class="tituloTexto">Título*: <input list="todosOsLivros" id="ipt_titulo"></div>
                    <datalist id="todosOsLivros"></datalist>

                    <div class="nomeAutor">Nome do autor: <input list="todosOsAutores" id="ipt_autor"></div>
                    <datalist id="todosOsAutores"></datalist>

                    <div class="paginas">Total de páginas*: <input id="ipt_totalPag"></div>

                    <div class="paginas">Qtd páginas lidas hoje:<input id="ipt_lidas"></div>

                    <div class="data">Data*: <input id="ipt_dia" maxlength="2">

                        <input list="mesR" id="messesR" name="messesR">

                        <datalist id="mesR">
                            <option value="Janeiro">
                            <option value="Fevereiro">
                            <option value="Março">
                            <option value="Abril">
                            <option value="Maio">
                            <option value="Junho">
                            <option value="Julho">
                            <option value="Agosto">
                            <option value="Setembro">
                            <option value="Outubro">
                            <option value="Novembro">
                            <option value="Dezembro">
                        </datalist>

                        <input id="ipt_ano" maxlength="4">

                    </div>

                    <div class="diaSemana">Dia da semana*:
                        <input list="diaR" id="diasR" name="diasR">

                        <datalist id="diaR">
                            <option value="Segunda">
                            <option value="Terça">
                            <option value="Quarta">
                            <option value="Quinta">
                            <option value="Sexta">
                            <option value="Fim de Semana">
                        </datalist>
                    </div>
                    <div>
                        Status da leitura*: <input list="condicao" id="cond" name="cond">
                        <datalist id="condicao">
                            <option value="Iniciado">
                            <option value="Lendo">
                            <option value="Finalizado">
                        </datalist>
                    </div>
                </div>
                <button class="btnAdicionar" onclick="InserirDados()">Adicionar +</button>

            </div>


            <div class="registroDiario">

                <div class="concluidosI">
                    <scroll-container>
                        <scroll-page id="page-1"> * Titulo: Nome do livro - Data: 06/Fevereiro/2023 - Fim de Semana - 10
                            páginas (faltam 180 páginas)</scroll-page>
                        <scroll-page id="page-2"> * Titulo: Nome do livro - Data: 07/Fevereiro/2023 - Segunda - 10
                            páginas (faltam 180 páginas)</scroll-page>
                        <scroll-page id="page-3"> * Titulo: Nome do livro - Data: 08/Fevereiro/2023 - Terça - 10 páginas
                            (faltam 180 páginas)</scroll-page>

                    </scroll-container>

                </div>
                <button class="btnConcluido">Adicionar em Concluídos</button>
            </div>
        </div>


        <!-- Segunda coluna -->
        <div class="segunda_coluna02">
            <div class="livrosConcluidos">

                <div class="tituloC">Lista de livros/folhetos concluídos</div>
                <!-- <nav>
                    <a href="#page-1">1</a>
                    <a href="#page-2">2</a>
                    <a href="#page-3">3</a>
                  </nav> -->

                <div class="concluidos">
                    <scroll-container>
                        <scroll-page id="page-1"> * Titulo: Nome do livro - Data Inicial: 01/01/2023 - Data Final:
                            08/Janeiro/2023 - total de páginas: 240.</scroll-page>
                        <scroll-page id="page-2">2</scroll-page>
                        <scroll-page id="page-3">3</scroll-page>

                    </scroll-container>

                </div>
            </div>
            <div class="totalPaginas">
                <div class="qtdPag">
                    <div id="msg"></div>
                    Total de páginas:<div id="totalP">500</div>
                </div>
            </div>
        </div>

    </div>

</body>

</html>
<script>

    selectLivrosExistentes();
    selectID_REGISTROIniciado();

    selectLendo();

    function selectLendo() {
        var idUsuario = sessionStorage.ID_USUARIO;
        //    id e titulo do livro que o usuario não finalizou
        // Tabela livro com tabela registro para puxar a informação

        fetch(`/livros/lendo/${idUsuario}`, {
            cache: "no-store",
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO SELECT Lendo()!!!!!!!!!!!")
            //   alert(idUsuario)
            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    sessionStorage.ID_LENDO = json.idLivro;
                    sessionStorage.TITULO = json.nome;
                    sessionStorage.DATA_INICIAL = json.dataInicial;
                });
            } else {
                console.log("Houve um erro ao tentar realizar o SELECT!!!!!!!!!");

                resposta.text().then(texto => {
                    console.error(texto);
                });
            }
        }).catch(function (erro) {
            console.log(erro);
        })
        return false;
    }

    function InserirDados() {
        // var nomeLivro = ipt_titulo.value;
        // var nomeAutor = ipt_autor.value;
        // var totalPaginas = ipt_totalPag.value;
        // var dia = ipt_dia.value;
        // var mes = messesR.value;
        // var ano = ipt_ano.value;
        // var totalPagLidasHoje = ipt_lidas.value;
        // var diaSemana = diasR.value;

        var condicao = cond.value;

        var continuar = true;

        // Iniciado 1º
        if (condicao == "Iniciado") {
            condição = true;
            selectLivroCadastrado()
            
            // Selecionar no gegistro se possui uma condição 'i', caso possua, não deixar iniciar novamente, e caso não pussua, não deixar inserir como lendo, antes de iniciar
            
            // if (sessionStorage.ID_REGISTRO_I != null) {
                
                //     alert("Esse livro já foi iniciado");
                //     continuar = false;
                // }
                
                
                // if (continuar == true) {
                    if (sessionStorage.ID_LIVRO == null) {
                        alert(`${nomeLivro}, ${nomeAutor} , ${totalPaginas}`)
                        insertTabelaLivro();
                        selectLendo();
                        // selectLivroCadastrado()
                        
                    }
                    if (sessionStorage.ID_LENDO == null || sessionStorage.ID_LIVRO != null) {
                        alert("A")
                        insertTabelaRegistroI();
                        selectLendo();
                        selectID_REGISTROIniciado();
                    }

            // }
        }

        // Lendo 2º
        if (condicao == "Lendo") {

            condição = true;

            // Se o idRegistro for = null, é porque não possui uma condição 'i', caso possua, não deixar iniciar novamente, e caso não pussua, não deixar inserir como lendo, antes de iniciar.
            // selectLivroCadastrado();
            selectLendo();

            if (sessionStorage.ID_LIVRO != sessionStorage.ID_LENDO) {
                alert(`O titulo do livro que está tentando registrar não corresponde ao livro que estava lendo. Precisa terminar concluir o livro em andamento para iniciar outro :) - O livro não concluido é ${sessionStorage.TITULO}`)
                continuar = false;
            }
            if (sessionStorage.ID_REGISTRO_I == null || sessionStorage.ID_LENDO == undefined) {
                alert("Esse livro não foi iniciado");
                continuar = false;
            }
            // selectID_REGISTROIniciado();

            if (continuar == true) {
                insertTabelaRegistroL();
                // selectLivroCadastrado();

                // Utilizar idUsuario e idLlivro na condição lendo para adicionar a data inicial
                // X Fazer update no registro inserido para colocar data inicial - A data Inicial está sendo inserida junto com os outros dados, pois foi alocada em um session storage chamado DATA_INICIAL e passado pela função insertTabelaRegistroL(); - portanto não precia de update
            }

        }
        // Finalizado 3º
        if (condicao == "Finalizado") {
            // selectLivroCadastrado();
            condição = true;

            selectLendo();

            if (sessionStorage.ID_LENDO == null || sessionStorage.ID_LENDO == undefined) {
                alert(`esse titulo não foi iniciado para poder ser finalizado. Portanto não é possivel registrar sua conlusão:(`)
                continuar = false;
            }
            if (continuar == true) {
                condicao = "f";

                insertTabelaRegistroF();

                // selectDataFinal;

                // Fazer um UPDATE registro SET dataFinal = '${ano}-${mesNumerico}-${dia}' WHERE condicao <> 'f' AND idUsuario = ${idUsuario} AND idLivros = ${idLendo};
                updateDataFinal();
                // Depois fazer outro UPDATE registro SET condicao = 'f' WHERE condicao <> 'f' AND idUsuario = ${idusuario} AND idLivros = ${idLendo};
                updateCondicaoFinal();

                // selectLivroCadastrado();
            }
            sessionStorage.ID_LENDO = null;
            sessionStorage.ID_LIVRO = null;
            sessionStorage.TITULO = null;
            sessionStorage.ID_REGISTRO_I = null;
            sessionStorage.DATA_INICIAL = null;
        }

        // alert(`${nomeLivro}, ${totalPaginas}, ${totalPagLidasHoje}, ${dia}, ${mes}, ${ano}, ${diaSemana}, ${condicao}`)


        ipt_titulo.value = '';
        cond.value = '';
    }

    function insertTabelaLivro() {
        var nomeLivro = ipt_titulo.value;
        var nomeAutor = ipt_autor.value;
        var totalPaginas = ipt_totalPag.value;

        // Enviando o valor da nova input
        fetch("/livros/cadastrarLivro", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/livros.js
                tituloServer: nomeLivro,
                autorServer: nomeAutor,
                totalPagServer: totalPaginas


            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                // cardErro.style.display = "block";

                alert("Livro cadastrado com sucesso")
                // limparFormulario();
                selectLivroCadastrado()

            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    }

    function insertTabelaRegistroI() {
        var idUsuario = sessionStorage.ID_USUARIO;
        var idLivro = sessionStorage.ID_LIVRO;

        var dia = ipt_dia.value;
        var mes = messesR.value;
        var ano = ipt_ano.value;


        var diaSemana = diasR.value;
        var totalPagLidasHoje = ipt_lidas.value;
        var condicao = "i";

        // Ajustar mes para numero para inserir na tabela registro
        var mesNumerico = '';

        if (mes == "Janeiro") {
            mesNumerico = "01";
        } else if (mes == "Fevereiro") {
            mesNumerico = "02";
        } else if (mes == "Março") {
            mesNumerico = "03";
        } else if (mes == "Abril") {
            mesNumerico = "04";
        } else if (mes == "Maio") {
            mesNumerico = "05";
        } else if (mes == "Junho") {
            mesNumerico = "06";
        } else if (mes == "Julho") {
            mesNumerico = "07";
        } else if (mes == "Agosto") {
            mesNumerico = "08";
        } else if (mes == "Setembro") {
            mesNumerico = "09";
        } else if (mes == "Outubro") {
            mesNumerico = "10";
        } else if (mes == "Novembro") {
            mesNumerico = "11";
        } else if (mes == "Dezembro") {
            mesNumerico = "12";
        }

        // Enviando o valor da nova input
        fetch("/registros/inserirRegistroI", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/livros.js
                idUsuarioServer: idUsuario,
                idLivroServer: idLivro,
                diaServer: dia,
                mesServer: mes,
                anoServer: ano,
                diaSemanaServer: diaSemana,
                pagHojeServer: totalPagLidasHoje,
                condicaoServer: condicao,
                mesNumericoServer: mesNumerico

            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                // cardErro.style.display = "block";

                alert("Registro realizado com sucesso!")
                alert("O Registro Inicial foi realizado com sucesso;")
                // limparFormulario();
                // selectLivroCadastrado()

            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
                alert("Cofira se inseriu corretamente os dados nos campos. ATENÇÂO!!! para dias como 1, 2, 3, 4,...,9 FAVOR INSERIR UM '0' na frente. EXEMPLO: 01, 02,,03...,09.")
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    }

    // ---------------------------- Lendo 2º ---------------------------

    function insertTabelaRegistroL() {
        var idUsuario = sessionStorage.ID_USUARIO;
        var idLivro = sessionStorage.ID_LIVRO;

        var dia = ipt_dia.value;
        var mes = messesR.value;
        var ano = ipt_ano.value;


        var diaSemana = diasR.value;
        var totalPagLidasHoje = ipt_lidas.value;
        var condicao = "l";

        var dataInicial = sessionStorage.DATA_INICIAL;

        // Enviando o valor da nova input
        fetch("/registros/inserirRegistroL", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/livros.js
                idUsuarioServer: idUsuario,
                idLivroServer: idLivro,
                diaServer: dia,
                mesServer: mes,
                anoServer: ano,
                diaSemanaServer: diaSemana,
                pagHojeServer: totalPagLidasHoje,
                condicaoServer: condicao,
                dataInicialServer: dataInicial

            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                // cardErro.style.display = "block";

                alert("Registro realizado com sucesso!")
                alert("O Registro Lendo foi realizado com sucesso;")
                // limparFormulario();
                // selectLivroCadastrado()

            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
                alert("Cofira se inseriu corretamente os dados nos campos. ATENÇÂO!!! para dias como 1, 2, 3, 4,...,9 FAVOR INSERIR UM '0' na frente. EXEMPLO: 01, 02,,03...,09.")
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    }

    // ---------------------------- Finalizado 3º ---------------------------

    function insertTabelaRegistroF() {
        var idUsuario = sessionStorage.ID_USUARIO;
        var idLivro = sessionStorage.ID_LIVRO;

        var dia = ipt_dia.value;
        var mes = messesR.value;
        var ano = ipt_ano.value;


        var diaSemana = diasR.value;
        var totalPagLidasHoje = ipt_lidas.value;
        var condicao = "f";

        var dataInicial = sessionStorage.DATA_INICIAL;

        // Ajustar mes para numero para inserir na tabela registro
        var mesNumerico = '';

        if (mes == "Janeiro") {
            mesNumerico = "01";
        } else if (mes == "Fevereiro") {
            mesNumerico = "02";
        } else if (mes == "Março") {
            mesNumerico = "03";
        } else if (mes == "Abril") {
            mesNumerico = "04";
        } else if (mes == "Maio") {
            mesNumerico = "05";
        } else if (mes == "Junho") {
            mesNumerico = "06";
        } else if (mes == "Julho") {
            mesNumerico = "07";
        } else if (mes == "Agosto") {
            mesNumerico = "08";
        } else if (mes == "Setembro") {
            mesNumerico = "09";
        } else if (mes == "Outubro") {
            mesNumerico = "10";
        } else if (mes == "Novembro") {
            mesNumerico = "11";
        } else if (mes == "Dezembro") {
            mesNumerico = "12";
        }

        // Ajustar mes para numero para inserir na tabela registro
        var dataInicial = sessionStorage.DATA_INICIAL;

        // Enviando o valor da nova input
        fetch("/registros/inserirRegistroF", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/livros.js
                idUsuarioServer: idUsuario,
                idLivroServer: idLivro,
                diaServer: dia,
                mesServer: mes,
                anoServer: ano,
                diaSemanaServer: diaSemana,
                pagHojeServer: totalPagLidasHoje,
                condicaoServer: condicao,
                dataInicialServer: dataInicial,
                mesNumericoServer: mesNumerico

            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                // cardErro.style.display = "block";

                alert("Registro realizado com sucesso!")
                alert("O Registro Final foi realizado com sucesso;")
                // limparFormulario();
                // selectLivroCadastrado()

            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
                alert("Cofira se inseriu corretamente os dados nos campos. ATENÇÂO!!! para dias como 1, 2, 3, 4,...,9 FAVOR INSERIR UM '0' na frente. EXEMPLO: 01, 02,,03...,09.")
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    }

    function updateDataFinal() {
        var idUsuario = sessionStorage.ID_USUARIO;
        var idLivro = sessionStorage.ID_LIVRO;

        var dia = ipt_dia.value;
        var mes = messesR.value;
        var ano = ipt_ano.value;
        var mesNumerico = '';

        if (mes == "Janeiro") {
            mesNumerico = "01";
        } else if (mes == "Fevereiro") {
            mesNumerico = "02";
        } else if (mes == "Março") {
            mesNumerico = "03";
        } else if (mes == "Abril") {
            mesNumerico = "04";
        } else if (mes == "Maio") {
            mesNumerico = "05";
        } else if (mes == "Junho") {
            mesNumerico = "06";
        } else if (mes == "Julho") {
            mesNumerico = "07";
        } else if (mes == "Agosto") {
            mesNumerico = "08";
        } else if (mes == "Setembro") {
            mesNumerico = "09";
        } else if (mes == "Outubro") {
            mesNumerico = "10";
        } else if (mes == "Novembro") {
            mesNumerico = "11";
        } else if (mes == "Dezembro") {
            mesNumerico = "12";
        }
        fetch(`/registros/updateDataFinal/${idUsuario}/${idLivro}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                IdUsuarioServer: idUsuario,
                idLivroServer: idLivro,
                diaServer: dia,
                mesNumericoServer: mesNumerico,
                anoServer: ano
            }),
        })
            .then(function (resposta) {
                console.log(resposta);
                alert("dataFinal inserido em todos")
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    }
    // _____________________________________Update condição 'f'_______________________
    function updateCondicaoFinal() {
        var idUsuario = sessionStorage.ID_USUARIO;
        var idLivro = sessionStorage.ID_LIVRO;

        fetch(`/registros/updateCondicaoFinal/${idUsuario}/${idLivro}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                IdUsuarioServer: idUsuario,
                idLivroServer: idLivro
            }),
        })
            .then(function (resposta) {
                console.log(resposta);
                alert("condição = 'f'")
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    }
    // ---\\---

    function selectLivrosExistentes() { //ATUALIZAR DATALIST DOS PONTOS
        //   var nomeLivro = ipt_titulo.value;

        fetch("/livros/listar").then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var feed = document.getElementById("todosOsLivros");
                    var mensagem = document.createElement("option");
                    var feed02 = document.getElementById("todosOsAutores");
                    var mensagem02 = document.createElement("option");
                    mensagem.innerHTML = "Nenhum resultado encontrado." //SE NÂO APARECER NADA, MUDAR AQUI
                    feed.appendChild(mensagem);
                    mensagem02.innerHTML = "Nenhum resultado encontrado." //SE NÂO APARECER NADA, MUDAR AQUI
                    feed02.appendChild(mensagem02);
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));
                    // pontos = resposta;

                    var feed = document.getElementById("todosOsLivros");
                    var feed02 = document.getElementById("todosOsAutores");
                    feed.innerHTML = "";
                    feed02.innerHTML = "";

                    for (let i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];

                        var opcao = document.createElement("option");

                        opcao.innerHTML = `${publicacao.nome}`;

                        feed.appendChild(opcao);
                    }
                    for (let i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];

                        var opcao = document.createElement("option");

                        opcao.innerHTML = `${publicacao.nomeAutor}`;

                        feed02.appendChild(opcao);
                    }
                });
            } else {
                throw ("Houve um erro na API")
            }
        }).catch(function (resposta) {
            console.error(resposta);
        });
    }
    // -----\\----
    function selectLivroCadastrado() {
        var nomeLivro = ipt_titulo.value;
        // var nomeAutor = ipt_autor.value;
        // var totalPaginas = ipt_totalPag.value;

        fetch(`/livros/autenticar/${nomeLivro}`, {
            cache: "no-store",
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO SELECT LivroCadastrado()!!!!!!!!!!!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    sessionStorage.ID_LIVRO = json.idLivro;
                });
            } else {
                console.log("Houve um erro ao tentar realizar o SELECT!!!!!!!!!");

                resposta.text().then(texto => {
                    console.error(texto);
                });
            }
        }).catch(function (erro) {
            console.log(erro);
        })
        return false;
    }

    function selectID_REGISTROIniciado() {
        var idUsuario = sessionStorage.ID_USUARIO;
        var idLivro = sessionStorage.ID_LIVRO;

        // var nomeAutor = ipt_autor.value;
        // var totalPaginas = ipt_totalPag.value;

        fetch(`/registros/autenticar/${idUsuario}/${idLivro}`, {
            cache: "no-store",
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO selectID_REGISTROIniciado()!!!!!!!!!!!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    sessionStorage.ID_REGISTRO_I = json.idRegistro;
                });
            } else {
                console.log("Houve um erro ao tentar realizar o SELECT do idRegistro!!!!!!!!!");

                resposta.text().then(texto => {
                    console.error(texto);
                });
            }
        }).catch(function (erro) {
            console.log(erro);
        })
        return false;
    }
    // ________________________________________________________________________________________________________________________

    function consultar(params) {

        const ctx = document.getElementById('myChart');

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Segundas', 'Terças', 'Quartas', 'Quintas', 'Sextas', 'FS'],
                datasets: [
                    {
                        label: 'Total de páginas',
                        backgroundColor: 'rgb(50,153,204)',
                        borderColor: 'rgb(50,153,204)',
                        data: [80, 82, 80, 85, 80, 83],
                        borderWidth: 2
                    }
                ]
            }
            // ,

            //     options: {
            //         scales: {
            //             y: {
            //                 min: 20,
            //                 max: 90,
            //                 ticks: {
            //                     stepSize: 10
            //                 }
            //             }
            //         }
            //     }
        });
    }

    // Gráfico Pie ou pizza

    const modelos = [
        "Segundas",
        "Terças",
        "Quartas",
        "Quintas",
        "Sextas",
        "Fins de Semana",
    ]
    const dadosSemana = {
        labels: modelos,
        datasets: [{
            data: [6, 5, 4, 3, 2, 1],
            backgroundColor: ['#6CE5E8', '#41B8D5', '#2D8BBA', '#2F5F98', '#31356E', '#A66C98']
        }
        ]
    }
    const configGraficoSemana = {
        type: "pie",
        data: dadosSemana,
        options: {
            plugins: {
                legend: {
                    position: "bottom"
                }
            }
        }
    }
    const graficoSemana = new Chart(
        document.getElementById("graficoSemana"),
        configGraficoSemana
    );

    // _________________________________________________________________________________

    //   function receberUserLogado(UsuarioLogado) {
    var nomeUsuario = sessionStorage.NOME_USUARIO;
    nomeDoUsuario.innerHTML = `${sessionStorage.NOME_USUARIO}`;
    //   }


    function sair() {
        sessionStorage.ID_USUARIO = null;
        window.location = "index.html";
    }
</script>